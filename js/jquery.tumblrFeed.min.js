(function ($) {
    $.fn.tumblrFeed = function (customOptions) {
        var options = $.extend({}, $.fn.tumblrFeed.defaultOptions, customOptions);
        return this.each(function () {
            var $this = $(this);
            myJsonpCallback = function (data) {
                console.log(data)  
                $.each(data.response.posts, function (i, post) {
                    if (post.type == "photo") {
                        $($this).append("<div class='WorkPost'>" + getImages(post) + post.caption + post.post_url + "<div class='tags'>" + getTags(post) +"</div></div>");
                    }
                });
            };
            function getImages(post) {
                var html = [];
                $.each(post.photos, function (i, photo) {
                    html.push('<img src=' + photo.alt_sizes[1].url + '>')
                })
                return html.join("");
            };

            function getTags(post) {
                var html = [];
                $.each(post.tags, function (i, tag) {
                    html.push("#"+ post.tags[i] +" ")
                })
                return html.join("");
            };
            
/*            function getUrl(post) {
                var html = [];
                $.each(post.url, function (i, url) {
                    html.push("##+ tumblr_api_read[1][0]['url']" ")
                })
                return html.join("");
            };*/

            
            $.ajax({
                type: "GET",
                url: "http://api.tumblr.com/v2/blog/" + options.tumblrUsername + ".tumblr.com/posts",
                dataType: "jsonp",
                data: {
                    api_key: options.apikey,
                    jsonp: "myJsonpCallback",
                    limit: options.postLimit,
                    type: options.postType
                }
            });
        });
        $.fn.tumblrFeed.defaultOptions = {
            tumblrUsername: "",
            apikey: "",
            postLimit: 20
        };
    };
})(jQuery);