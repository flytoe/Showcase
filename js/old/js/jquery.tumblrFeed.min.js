(function ($) {
    $.fn.tumblrFeed = function (customOptions) {
        var options = $.extend({}, $.fn.tumblrFeed.defaultOptions, customOptions);
        return this.each(function () {
            var $this = $(this);
            myJsonpCallback = function (data) {
                $.each(data.response.posts, function (i, post) {
                    if (post.type == "photo") {
                        $($this).append("<a class='PostUrl' target='_blank' href=" + post.post_url + "><div class='WorkPost'>" + getImages(post) + post.caption + "</div></a>");
                    }
                });
            };
            
//            myJsonpCallback = function (data) {
//                console.log(data)
//                $.each(data.response.posts, function (i, post) {
//                    if (post.type == "photo") {
//                        $($this).append("<a target='_blank' href=" + post.post_url + "><div class='WorkPost'>" + getImages(post) + post.caption + "<div class='tags'>" + getTags(post) + "</div></div></a>");
//                    }
//                });
//            };

            function getImages(post) {
                var html = [];
                $.each(post.photos, function (i, photo) {
                    html.push('<img src=' + photo.alt_sizes[1].url + '>')
                })
                return html.join("");
            };

            function getTags(post) {
                var html = [];
                $.each(post.tags, function (i, tag) {
                    html.push("#" + post.tags[i] + " ")
                })
                return html.join("");
            };

            $.ajax({
                type: "GET",
                url: "http://api.tumblr.com/v2/blog/" + options.tumblrUsername + ".tumblr.com/posts",
                dataType: "jsonp",
                data: {
                    api_key: options.apikey,
                    jsonp: "myJsonpCallback",
                    limit: options.postLimit,
                    type: options.postType
                }
            });
        });
        $.fn.tumblrFeed.defaultOptions = {
            tumblrUsername: "",
            apikey: "",
            postLimit: 20
        };
    };
})(jQuery);